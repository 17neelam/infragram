"use strict";var _createClass=function(){function t(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),_slicedToArray=function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var a=[],t=!0,o=!1,n=void 0;try{for(var i,l=e[Symbol.iterator]();!(t=(i=l.next()).done)&&(a.push(i.value),!r||a.length!==r);t=!0);}catch(e){o=!0,n=e}finally{try{!t&&l.return&&l.return()}finally{if(o)throw n}}return a}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}!function n(i,l,s){function c(a,e){if(!l[a]){if(!i[a]){var r="function"==typeof require&&require;if(!e&&r)return r(a,!0);if(u)return u(a,!0);var t=new Error("Cannot find module '"+a+"'");throw t.code="MODULE_NOT_FOUND",t}var o=l[a]={exports:{}};i[a][0].call(o.exports,function(e){var r=i[a][1][e];return c(r||e)},o,o.exports,n,i,l,s)}return l[a].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)c(s[e]);return c}({1:[function(e,r,a){r.exports=function(){function t(){var e=window.location.hash;e&&(e=e.split("#")[1]);var r=e.split("&"),a={};return r.forEach(function(e,r){""!=(e=e.split("="))[0]&&(a[e[0]]=e[1])}),a}function o(e){var a=Object.keys(e),t=Object.values(e),o=[];a.forEach(function(e,r){""!=e&&o.push(a[r]+"="+t[r])});var r=o.join("&");window.location.hash=r}return{getUrlHashParameter:function(e){return t()[e]},getUrlHashParameters:t,setUrlHashParameter:function(e,r){var a=t();a[e]=r,o(a)},setUrlHashParameters:o}}},{}],2:[function(a,e,r){window.Infragram=function(r){(r=r||{}).uploader=r.uploader||!1,r.processor=r.processor||"javascript",r.camera=a("./io/camera")(r),r.colorized=r.colorized||!1,r.mode=r.mode||"raw",r.video_live=r.video_live||!1,r.webGlSupported=r.webGlSupported||!1,r.processors={webgl:a("./processors/webgl"),javascript:a("./processors/javascript")},r.processor=r.processors[r.processor](),r.logger=a("./logger")(r);var e=a("./ui/interface")(r);return r.processor.initialize(),console.log("processor:",r.processor.type),r.colorize=function(){r.processor.colorize()},r.run=function(e){return r.logger.save_log(),r.processor.run(e)},r.video=function(){r.camera.initialize(),r.webGlSupported?setInterval(function(){if(image&&r.run(r.mode),r.camera.getSnapshot(),r.colorized)return r.colorize()},15):setInterval(function(){if(image&&r.run(r.mode),r.camera.getSnapshot(),r.colorized)return r.colorize()},250)},{Camera:r.camera,Interface:e,logger:r.logger,run:r.run,colorize:r.colorize,processors:r.processors,options:r}},e.exports=Infragram},{"./io/camera":6,"./logger":7,"./processors/javascript":8,"./processors/webgl":9,"./ui/interface":11}],3:[function(n,e,r){e.exports=function(e){var r=o([[0,[0,0,0],[255,255,255]],[1,[255,255,255],[255,255,255]]]),a=o([[0,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.75,[255,255,0],[255,50,50]]]),t=o([[0,[0,0,255],[0,0,255]],[.1,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.7,[255,255,0],[255,50,50]],[.9,[255,50,50],[255,50,50]]]),g=n("../util/JsImage.js");function o(p){return function(e){var r,a,t,o,n,i,l,s,c,u,m,d=[p[m=u=0][0],1];if(s=d[1],e<(l=d[0]))return u;for(r=a=0,t=p.length;a<t;r=++a){var g=_slicedToArray(p[r],3);if(c=g[0],u=g[1],m=g[2],l=c,r===p.length-1){s=1;break}if(s=p[r+1][0],c<=e&&e<s)break}for(i=[],r=o=0,n=u.length;0<=n?o<n:n<o;r=0<=n?++o:--o)i[r]=(e-l)/(s-l)*(m[r]-u[r])+u[r];return i}}return{colorify:function(e,r){var a,t,o,n,i,l,s,c,u;for($("#btn-colorize").addClass("active"),s=e.width*e.height,t=new Uint8ClampedArray(4*s),n=l=i=0,u=s;0<=u?l<u:u<l;n=0<=u?++l:--l){var m=r(e.data[n]),d=_slicedToArray(m,3);c=d[0],o=d[1],a=d[2],t[i++]=c,t[i++]=o,t[i++]=a,t[i++]=255}return new g(t,e.width,e.height,4)},colormap1:a,colormap2:t,greyscale_colormap:r,segmented_colormap:o}}},{"../util/JsImage.js":12}],4:[function(e,r,a){r.exports=window.Converters={hsv2rgb:function(e,r,a){var t,o,n,i,l,s;if([],0===r)l=[a,a,a];else switch(i=a*(1-(t=6*e-(o=Math.floor(6*e)))*r),s=a*(1-(1-t)*r),[n=a*(1-r),a*(1-r*(e-o)),a*(1-r*(1-(e-o)))],o){case 0:l=[a,s,n];break;case 1:l=[i,a,n];break;case 2:l=[n,a,s];break;case 3:l=[n,i,a];break;case 4:l=[s,n,a];break;default:l=[a,n,i]}return l},rgb2hsv:function(e,r,a){var t,o,n,i,l,s;if(o=s=n=Math.max(e,r,a),t=n-(i=Math.min(e,r,a)),l=0===n?0:t/n,n===i)o=0;else{switch(n){case e:o=(r-a)/t+(r<a?6:0);break;case r:o=(a-e)/t+2;break;case a:o=(e-r)/t+4}o/=6}return[o,l,s]}}},{}],5:[function(require,module,exports){module.exports=window.FileUpload={socket:null,file:null,serverFilename:"",isLoadedFromFile:function(){return!!FileUpload.file},getFilename:function(){return FileUpload.serverFilename},setFilename:function(e){return FileUpload.serverFilename=e},uploadThumbnail:function(e,t){var r;return(r=new Image).onload=function(){var e,r,a;return r=(e=document.createElement("canvas")).getContext("2d"),e.width=260,e.height=195,r.drawImage(this,0,0,this.width,this.height,0,0,e.width,e.height),t=t.toString(),a=e.toDataURL("image/jpeg"),FileUpload.socket.emit("thumbnail_start",{name:FileUpload.serverFilename,data:a,callback:t})},r.src=e},fromFile:function(e,a,r){var t;if(e&&e[0])return $("#file-sel").prop("disabled",!0),$("#save-modal-btn").prop("disabled",!0),FileUpload.file=e[0],FileUpload.file.reader=new FileReader,r&&(FileUpload.file.reader.onload=function(e){return FileUpload.socket.emit("image_send",{name:FileUpload.serverFilename,size:FileUpload.file.size,data:e.target.result})},FileUpload.socket.emit("image_send",{name:e[0].name,size:e[0].size})),FileUpload.file.uploaded=0,(t=new FileReader).onload=function(e){var r;return(r=new Image).onload=function(){return a(this)},r.src=e.target.result},t.readAsDataURL(e[0])},duplicate:function(e){return e=e.toString(),FileUpload.socket.emit("duplicate_start",{name:FileUpload.serverFilename,callback:e})},fromBase64:function(e,r,a){return a=a.toString(),FileUpload.socket.emit("base64_start",{name:e,data:r,callback:a})},initialize:function initialize(options){options=options||{},options.rememberTransport=options.rememberTransport||!1,options.transports=options.transports||["websocket","AJAX long-polling"],options.socket&&(FileUpload.socket=io.connect(window.location.protocol+"//"+window.location.host,options),FileUpload.socket.on("image_request",function(e){var r,a,t;return r=FileUpload.file,t=$("#save-modal-btn").html().split(/\s-\s/g)[0],t+=" - "+Math.round(r.uploaded/r.size*100)+"%",$("#save-modal-btn").html(t),a=r.slice(r.uploaded,r.uploaded+Math.min(e.chunk,r.size-r.uploaded)),FileUpload.file.uploaded+=e.chunk,FileUpload.serverFilename=e.name,r.reader.readAsDataURL(a)}),FileUpload.socket.on("image_done",function(e){var r;return e.error?alert(e.error):FileUpload.serverFilename=e.name,r=$("#save-modal-btn").html().split(/\s-\s/g)[0],$("#save-modal-btn").html(r),$("#file-sel").prop("disabled",!1),$("#save-modal-btn").prop("disabled",!1)}),FileUpload.socket.on("base64_done",function(data){return FileUpload.serverFilename=data.name,eval("var callback="+data.callback),callback()}),FileUpload.socket.on("duplicate_done",function(data){return data.error?alert(data.error):(FileUpload.serverFilename=data.name,eval("var callback="+data.callback),callback())}),FileUpload.socket.on("thumbnail_done",function(data){return eval("var callback="+data.callback),callback()}))}}},{}],6:[function(e,r,a){r.exports=function(r){var e,u;var m=r.webRtcOptions||{audio:!1,video:!0,el:"webcam",extern:null,append:!0,width:640,height:480,mode:"callback",debug:function(){},onCapture:function(){return window.webcam.save()},onSave:a,onLoad:function(){}};function a(e){var r,a,t,o,n,i,l,s,c=0;for(r=e.split(""),o=camera.image,l=null,s=m.width,a=m.height,t=n=0,i=s-1;0<=i?n<=i:i<=n;t=0<=i?++n:--n)l=parseInt(r[t],10),o.data[c+0]=l>>16&255,o.data[c+1]=l>>8&255,o.data[c+2]=255&l,o.data[c+3]=255,c+=4;if(4*s*a<=c)return u.putImageData(o,0,0),0}function t(r){var e,a;if("webrtc"===m.context)return a=m.videoEl,e=window.URL||window.webkitURL,navigator.mozGetUserMedia?(a.mozSrcObject=r,console.log("mozilla???")):a.src=e?e.createObjectURL(r):r,a.onerror=function(e){return r.stop()}}function o(e){return alert("No camera available."),console.log(e),console.error("An error occurred: [CODE "+e.code+"]")}return{getSnapshot:function(){var e;return"webrtc"===m.context?(e=document.getElementsByTagName("video")[0],r.processor.updateImage(e),$("#webcam").hide()):"flash"===m.context?window.webcam.capture():void console.log("No context was supplied to getSnapshot()")},initialize:function(){getUserMedia(m,t,o),m.videoEl.setAttribute("autoplay","autoplay"),m.videoEl.setAttribute("playsinline","playsinline"),window.webcam=m,e=r.canvas||document.getElementById("image"),u=e.getContext("2d"),$("#snapshot").show(),$("#live-video").show(),$("#webcam").show()},onSaveGetUserMedia:a,webRtcOptions:m}}},{}],7:[function(e,r,a){r.exports=function(r){var a=[];function e(){var e;return e="mode=infragrammar_mono",e+=$("#m_exp").val()?"&m="+$("#m_exp").val():"",e+=r.colorized?"&c=true":"",a.push(e)}function t(){var e;return e="mode=infragrammar_hsv",e+=$("#h_exp").val()?"&h="+$("#h_exp").val():"",e+=$("#s_exp").val()?"&s="+$("#s_exp").val():"",e+=$("#v_exp").val()?"&v="+$("#v_exp").val():"",a.push(e)}function o(){var e;return e="mode=infragrammar",e+=$("#r_exp").val()?"&r="+$("#r_exp").val():"",e+=$("#g_exp").val()?"&g="+$("#g_exp").val():"",e+=$("#b_exp").val()?"&b="+$("#b_exp").val():"",a.push(e)}return{log:a,log_hsv:t,log_mono:e,log_rgb:o,save_log:function(){return"infragrammar_mono"===r.mode?e():"infragrammar_hsv"===r.mode?t():"infragrammar"===r.mode?o():void 0}}}},{}],8:[function(require,module,exports){module.exports=function javascriptProcessor(){var b_exp="",g_exp="",get_channels,Colormaps=require("../color/colormaps")(JsImage),colormap=Colormaps.colormap1,converters=require("../color/converters"),image=null,jsHandleOnClickGrey,jsHandleOnClickNdvi,jsHandleOnClickRaw,jsHandleOnSlide,jsHandleOnSubmitInfra,jsHandleOnSubmitInfraHsv,jsHandleOnSubmitInfraMono,m_exp="",mode="raw",ndvi,r_exp="",set_mode,update_colorbar,JsImage=require("../util/JsImage.js");function histogram(e,r,t){var a,o,n,i,l,s,c=_slicedToArray(r,2),u=c[0],m=c[1];for(o=function(){var e,r,a;for(a=[],i=e=0,r=t;0<=r?e<r:r<e;i=0<=r?++e:--e)a.push(0);return a}(),n=(m-u)/t,l=0,s=e.length;l<s;l++)a=e[l],0<=(i=Math.floor((a-u)/n))&&i<t&&o[i]++;return o}function get_channels(r){var e,a,t,o,n,i,l,s;for(i=r.width*r.height,l=new Float32Array(i),a=new Float32Array(i),e=new Float32Array(i),t=o=0,s=i;0<=s?o<s:s<o;t=0<=s?++o:--o)l[t]=r.data[4*t+0],a[t]=r.data[4*t+1],e[t]=r.data[4*t+2];function n(e){return new JsImage(e,r.width,r.height,1)}return[n(l),n(a),n(e)]}function ndvi(e,r){var a,t,o,n,i;for(n=e.width*e.height,a=new Float64Array(n),t=o=0,i=n;0<=i?o<i:i<o;t=0<=i?++o:--o)a[t]=(e.data[t]-r.data[t])/(e.data[t]+r.data[t]);return new JsImage(a,e.width,e.height,1)}function infragrammar(e){var r,a,t,o,n,i,l,s;for($("#btn-colorize").removeClass("active"),n=e.width*e.height,l=new Float32Array(n),a=new Float32Array(n),r=new Float32Array(n),i=new Float32Array(4*n),t=o=0,s=n;0<=s?o<s:s<o;t=0<=s?++o:--o)l[t]=e.data[4*t+0]/255,a[t]=e.data[4*t+1]/255,r[t]=e.data[4*t+2]/255,i[4*t+0]=255*r_exp(l[t],a[t],r[t]),i[4*t+1]=255*g_exp(l[t],a[t],r[t]),i[4*t+2]=255*b_exp(l[t],a[t],r[t]),i[4*t+3]=255;return new JsImage(i,e.width,e.height,4)}function infragrammar_mono(e){var r,a,t,o,n,i,l,s;for(n=e.width*e.height,l=new Float32Array(n),a=new Float32Array(n),r=new Float32Array(n),i=new Float32Array(n),t=o=0,s=n;0<=s?o<s:s<o;t=0<=s?++o:--o)l[t]=e.data[4*t+0]/255,a[t]=e.data[4*t+1]/255,r[t]=e.data[4*t+2]/255,i[t]=r_exp(l[t],a[t],r[t]);return new JsImage(i,e.width,e.height,1)}function render(e){var r,a,t;return(t=$("#image")[0]).width=e.width,t.height=e.height,a=(r=t.getContext("2d")).getImageData(0,0,e.width,e.height),e.copyToImageData(a),r.putImageData(a,0,0)}function colorize(){var e=getImageData();return render(Colormaps.colorify(infragrammar_mono(e),function(e){return colormap((e+1)/2)})),!0}function update(e){var r,a,t,o,n,i;if($("#colorbar-container")[0].style.display="none","ndvi"===mode){var l=get_channels(e),s=_slicedToArray(l,3);n=s[0],s[1],r=s[2],o=ndvi(n,r),t=-1,a=1,i=Colormaps.colorify(o,function(e){return colormap((e-t)/(a-t))}),update_colorbar(t,a)}else if("raw"===mode)i=new JsImage(e.data,e.width,e.height,4);else if("nir"===mode){var c=get_channels(e),u=_slicedToArray(c,3);n=u[0],u[1],r=u[2],i=Colormaps.colorify(n,function(e){return[e,e,e]})}else i=infragrammar(e);return render(i)}function save_expressions(r,g,b){return""===r&&(r="R"),""===g&&(g="G"),""===b&&(b="B"),eval("r_exp = function(R,G,B){var r=R,g=G,b=B;return "+r+";}"),eval("g_exp = function(R,G,B){var r=R,g=G,b=B;return "+g+";}"),eval("b_exp = function(R,G,B){var r=R,g=G,b=B;return "+b+";}")}function save_expressions_hsv(h,s,v){return""===h&&(h="H"),""===s&&(s="S"),""===v&&(v="V"),eval("r_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[0];}"),eval("g_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[1];}"),eval("b_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[2];}")}function getImageData(){var e=$("#image")[0].getContext("2d"),r=$("#image").width(),a=$("#image").height();return image||e.getImageData(0,0,r,a)}function getJsImage(){var e=getImageData();return new JsImage(e.data,e.width,e.height,1)}function set_mode(e){return mode=e,update(getImageData()),"ndvi"===mode?$("#colormaps-group")[0].style.display="inline-block":0<$("#colormaps-group").length?$("#colormaps-group")[0].style.display="none":void 0}function updateImage(e){var r,a,t,o;return r=(t=document.getElementById("image")).getContext("2d"),o=e.videoWidth||e.width,a=e.videoHeight||e.height,r.drawImage(e,0,0,o,a,0,0,t.width,t.height),image=r.getImageData(0,0,t.width,t.height),set_mode(mode)}function run(e){return set_mode(e)}function getCurrentImage(){return $("#image")[0].getContext("2d").canvas.toDataURL("image/jpeg")}return update_colorbar=function(e,r){var a,t,o,n,i,l,s,c,u,m,d,g,p;for($("#colorbar-container")[0].style.display="inline-block",o=(t=(n=$("#colorbar")[0]).getContext("2d")).getImageData(0,0,n.width,n.height),l=u=0,g=n.width;0<=g?u<g:g<u;l=0<=g?++u:--u)for(s=m=0,p=n.height;0<=p?m<p:p<m;s=0<=p?++m:--m){var f=colormap(l/n.width),h=_slicedToArray(f,3);d=h[0],i=h[1],a=h[2],c=4*(l+s*n.width),o.data[c+0]=d,o.data[c+1]=i,o.data[c+2]=a,o.data[c+3]=255}return t.putImageData(o,0,0),$("#colorbar-min")[0].textContent=e.toFixed(2),$("#colorbar-max")[0].textContent=r.toFixed(2)},jsHandleOnClickRaw=function(){return set_mode("raw")},jsHandleOnClickNdvi=function(){return set_mode("ndvi")},jsHandleOnSubmitInfraHsv=function(){return save_expressions_hsv($("#h_exp").val(),$("#s_exp").val(),$("#v_exp").val()),set_mode("infragrammar_hsv")},jsHandleOnSubmitInfra=function(){return save_expressions($("#r_exp").val(),$("#g_exp").val(),$("#b_exp").val()),set_mode("infragrammar")},jsHandleOnSubmitInfraMono=function(){return save_expressions($("#m_exp").val(),$("#m_exp").val(),$("#m_exp").val()),set_mode("infragrammar_mono")},jsHandleOnClickGrey=function(){return colormap=Colormaps.greyscale_colormap,update(image)},{type:"javascript",colormap:colormap,getCurrentImage:getCurrentImage,getImageData:getImageData,getJsImage:getJsImage,infragrammar_mono:infragrammar_mono,infragrammar:infragrammar,render:render,run:run,save_expressions:save_expressions,save_expressions_hsv:save_expressions_hsv,update:update,updateImage:updateImage,colorize:colorize}}},{"../color/colormaps":3,"../color/converters":4,"../util/JsImage.js":12}],9:[function(d,e,r){e.exports=function(){var t=null,r=null,g=[-1,-1,-1,1,1,-1,1,1],e=0,p=d("../util/webgl-utils")(),u=!1;function a(){return t=n("raw",1,0,1,"image"),r=n("raw",1,1,1,"colorbar"),o(),e=2,$("#shader-vs").load("dist/shader.vert",l),$("#shader-fs-template").load("dist/shader.frag",l),!(!t||!r)}function o(){u=!1,$("#colorbar-container").css("display","none"),$("#colormaps-group").css("display","none")}function n(e,r,a,t,o){var n,i,l,s,c,u,m,d;return(n=new Object).mode=e,n.expression=["","",""],n.selColormap=r,n.colormap=a,n.slider=t,n.updateShader=!0,n.canvas=document.getElementById(o),n.canvas.addEventListener("webglcontextlost",function(e){return e.preventDefault()},!1),n.canvas.addEventListener("webglcontextrestored",f,!1),n.gl=p.getWebGLContext(n.canvas),n.gl?(n.gl.getExtension("OES_texture_float"),n.vertexBuffer=(u=g,m=(d=n.gl).createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,m),d.bufferData(d.ARRAY_BUFFER,new Float32Array(u),d.STATIC_DRAW),m.itemSize=u.itemSize,m),n.framebuffer=n.gl.createFramebuffer(),n.imageTexture=(l=(i=n).gl.TEXTURE0,c=(s=i.gl).createTexture(),s.activeTexture(l),s.bindTexture(s.TEXTURE_2D,c),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,i.canvas.width,i.canvas.height,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),c),n):null}function m(e,r){var a,t,o,n,i,l,s,c;if(r||window.requestAnimationFrame(function(){return m(e,!1)}),e.updateShader&&(e.updateShader=!1,e.shaderProgram=function(e){var r,a,t,o,n=_slicedToArray(e.expression,3);o=n[0],t=n[1],r=n[2],o=o.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),t=t.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),r=r.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),o=o.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),t=t.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),r=r.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),o=o.replace(/([0-9])([^\.])?/g,"$1.0$2"),t=t.replace(/([0-9])([^\.])?/g,"$1.0$2"),r=r.replace(/([0-9])([^\.])?/g,"$1.0$2"),"ndvi"===e.mode&&(""!==o&&(o="(("+o+") + 1.0) / 2.0"),""!==t&&(t="(("+t+") + 1.0) / 2.0"),""!==r&&(r="(("+r+") + 1.0) / 2.0"));""===o&&(o="r");""===t&&(t="g");""===r&&(r="b");return a=(a=(a=(a=$("#shader-fs-template").html()).replace(/@1@/g,o)).replace(/@2@/g,t)).replace(/@3@/g,r),$("#shader-fs").html(a),p.createProgramFromScripts(e.gl,["shader-vs","shader-fs"])}(e)),(a=e.gl).viewport(0,0,e.canvas.width,e.canvas.height),a.useProgram(e.shaderProgram),a.bindBuffer(a.ARRAY_BUFFER,e.vertexBuffer),c=a.getAttribLocation(e.shaderProgram,"aVertexPosition"),a.enableVertexAttribArray(c),a.vertexAttribPointer(c,e.vertexBuffer.itemSize,a.FLOAT,!1,0,0),i=a.getUniformLocation(e.shaderProgram,"uSampler"),a.uniform1i(i,0),s=a.getUniformLocation(e.shaderProgram,"uSlider"),a.uniform1f(s,e.slider),n=a.getUniformLocation(e.shaderProgram,"uColorized"),a.uniform1i(n,u||e.colormap?1:0),l=a.getUniformLocation(e.shaderProgram,"uSelectColormap"),a.uniform1i(l,e.selColormap),o=a.getUniformLocation(e.shaderProgram,"uHsv"),a.uniform1i(o,"hsv"===e.mode?1:0),t=a.getUniformLocation(e.shaderProgram,"uColormap"),a.uniform1i(t,e.colormap?1:0),a.drawArrays(a.TRIANGLE_STRIP,0,g.length/g.itemSize),r)return e.canvas.toDataURL("image/jpeg")}function i(e,r){e.mode!=r&&(e.updateShader=!0),e.mode=r}function l(){if(!(e-=1))return m(t),m(r)}function f(){var e;if(e=t.imageData,t=n(t.mode,t.selColormap,t.colormap,t.slider,"image"),r=n(r.mode,r.selColormap,r.colormap,r.slider,"colorbar"),t&&r)return s(e)}function s(e){var r;return r=t.gl,t.imageData=e,r.activeTexture(r.TEXTURE0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}function c(e){return i(t,e)}return g.itemSize=2,a(),{type:"webgl",initialize:a,getCurrentImage:function(){return m(t,!0)},getImageData:function(){return t.imageData},run:c,save_expressions:function(e,r,a){return t.expression=[e,r,a]},setMode:i,updateImage:s,decolorize:o,colorize:function(e){"hsv"===e?c("hsv"):("string"==typeof e&&(e={default:0,stretched:2,grey:1}[e]),t.selColormap=r.selColormap=e,u=!0,$("#colorbar-container").css("display","inline-block"),$("#colormaps-group").css("display","inline-block"))}}}},{"../util/webgl-utils":13}],10:[function(e,r,a){r.exports=function(e){$("#exit-fullscreen").click(function(){return $("#image").css("display","inline"),$("#image").css("position","relative"),$("#image").css("height","auto"),$("#image").css("left",0),$("#backdrop").hide(),$("#exit-fullscreen").hide(),$("#fullscreen").show(),!0}),$("#fullscreen").click(function(){return $("#image").css("display","block"),$("#image").css("height","100%"),$("#image").css("width","auto"),$("#image").css("position","absolute"),$("#image").css("top","0px"),$("#image").css("left",parseInt((window.innerWidth-$("#image").width())/2)+"px"),$("#image").css("z-index","2"),$("#backdrop").show(),$("#exit-fullscreen").show(),$("#fullscreen").hide(),!0})}},{}],11:[function(n,e,r){e.exports=function(a){a.imageSelector=a.imageSelector||"#image-container",a.fileSelector=a.fileSelector||"#file-sel";var r=n("urlhash")(),t=n("../file-upload"),o=a.logger;n("../color/colormaps");function e(){return a.mode=$("#modeSwitcher").val(),function(e){if("infragrammar"===a.mode)a.processor.save_expressions(e.r,e.g,e.b);else if("infragrammar_mono"===a.mode)a.processor.save_expressions(e.m,e.m,e.m);else if("infragrammar_hsv"===a.mode)return a.processor.save_expressions_hsv(e.h,e.s,e.v)}({r:$("#r_exp").val(),g:$("#g_exp").val(),b:$("#b_exp").val(),m:$("#m_exp").val(),h:$("#h_exp").val(),s:$("#s_exp").val(),v:$("#v_exp").val()})}$(document).ready(function(){return n("./fullscreen")(a),a.uploadable&&t.initialize({socket:a.uploadable}),$(a.imageSelector).ready(function(){"true"===r.getUrlHashParameter("legacy")?a.processor=a.processors.javascript():a.processor=a.processors.webgl(),"webgl"===a.processor&&$("#webgl-activate").html("&laquo; Go back to JS version");var e;return(e=r.getUrlHashParameter("src"))&&(params=parametersObject(location.search.split("?")[1]),a.mode=params.mode,fetch_image(e)),!0}),$(a.fileSelector).change(function(){return $("#save-modal-btn").show(),$("#save-zone").show(),t.fromFile(this.files,a.processor.updateImage,a.uploadable),$("#preset-modal").modal("show"),!0}),$("#preset_raw").click(function(){return $("#modeSwitcher").val("infragrammar").change(),$("#r_exp").val("R"),$("#g_exp").val("G"),$("#b_exp").val("B"),$("#preset-modal").modal("hide"),e(),a.run(a.mode)}),$("#preset_ndvi_blue").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),e(),a.run(a.mode)}),$("#preset_ndvi_blue_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),e(),a.colorized=!0,a.run(a.mode),a.colorize()}),$("#preset_ndvi_red").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),e(),a.run(a.mode)}),$("#preset_ndvi_red_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),e(),a.colorized=!0,a.run(a.mode),a.colorize()}),$("#btn-colorize").click(function(){return a.colorized=!0,a.run(a.mode),a.colorize()}),$("#default_colormap").click(function(){return a.colorized=!0,a.colorize("default"),$("#btn-colorize").addClass("active")}),$("#stretched_colormap").click(function(){return a.colorized=!0,a.colorize("stretched"),$("#btn-colorize").addClass("active")}),$("#download").click(function(){return downloadImage(),!0}),$("#save").click(function(){var e;function r(){return e=a.processor.getCurrentImage(),t.uploadThumbnail(e,function(){return $("#form-filename").val(t.getFilename()),$("#form-log").val(JSON.stringify(o.log)),$("#save-form").submit()})}return $("#save").prop("disabled",!0),$("#save").html("Saving..."),""===t.getFilename()?(e=a.processor.getCurrentImage(),t.fromBase64("camera",e,r)):!1===t.isLoadedFromFile()?t.duplicate(r):r(),!0}),$("#infragrammar_hsv").submit(function(){return a.mode="infragrammar_hsv",o.log_hsv(),e(),a.run(a.mode),!0}),$("#infragrammar").submit(function(){return a.mode="infragrammar",o.log_rgb(),e(),a.run(a.mode),!0}),$("#infragrammar_mono").submit(function(){return a.mode="infragrammar_mono",o.log_mono(),e(),a.run(a.mode),!0}),$("#webcam-activate").click(function(){return $("#save-modal-btn").show(),$("#save-zone").show(),e(),a.video(),$("#preset-modal").modal("show"),!0}),$("#snapshot").click(function(){return a.camera.getSnapshot(),!0}),$("#modeSwitcher").change(function(){return $("#infragrammar, #infragrammar_mono, #infragrammar_hsv").hide(),$("#"+$("#modeSwitcher").val()).css("display","inline"),!0}),$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),!0})}},{"../color/colormaps":3,"../file-upload":5,"./fullscreen":10,urlhash:1}],12:[function(e,r,a){r.exports=function(){function o(e,r,a,t){_classCallCheck(this,o),this.data=e,this.width=r,this.height=a,this.channels=t}return _createClass(o,[{key:"copyToImageData",value:function(e){return e.data.set(this.data)}},{key:"extrema",value:function(){var e,t,r,a,o,n,i,l,s,c;for(l=this.width*this.height,i=function(){var e,r,a;for(a=[],t=e=0,r=this.channels;0<=r?e<r:r<e;t=0<=r?++e:--e)a.push(this.data[t]);return a}.call(this),n=function(){var e,r,a;for(a=[],t=e=0,r=this.channels;0<=r?e<r:r<e;t=0<=r?++e:--e)a.push(this.data[t]);return a}.call(this),t=a=r=0,s=l;0<=s?a<s:s<a;t=0<=s?++a:--a)for(e=o=0,c=this.channels;0<=c?o<c:c<o;e=0<=c?++o:--o)this.data[r]>n[e]&&(n[e]=this.data[r]),this.data[r]<i[e]&&(i[e]=this.data[r]),r++;return[i,n]}}]),o}()},{}],13:[function(e,r,a){r.exports=function(){var d=function(e){window.console&&(window.console.error?window.console.error(e):window.console.log&&window.console.log(e))},a=function(){return window!=window.top},t=function(e,r){for(var a=["webgl","experimental-webgl"],t=null,o=0;o<a.length;++o){try{t=e.getContext(a[o],r)}catch(e){}if(t)break}return t},o=function(){a()&&(document.body.className="iframe")},l=function(e,r,a,t,o){for(var n=o||d,i=e.createProgram(),l=0;l<r.length;++l)e.attachShader(i,r[l]);if(a)for(l=0;l<a.length;++l)e.bindAttribLocation(i,t?t[l]:l,a[l]);return e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?i:(n("Error in program linking:"+e.getProgramInfoLog(i)),e.deleteProgram(i),null)},s=function(e,r,a,t){var o,n,i,l,s,c,u,m=document.getElementById(r);if(!m)throw"*** Error: unknown script element"+r;if(o=m.text,!a)if("x-shader/x-vertex"==m.type)n=e.VERTEX_SHADER;else if("x-shader/x-fragment"==m.type)n=e.FRAGMENT_SHADER;else if(n!=e.VERTEX_SHADER&&n!=e.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return l=o,s=a||n,c=t||d,u=(i=e).createShader(s),i.shaderSource(u,l),i.compileShader(u),i.getShaderParameter(u,i.COMPILE_STATUS)?u:(c("*** Error compiling shader '"+u+"':"+i.getShaderInfoLog(u)),i.deleteShader(u),null)},c=["VERTEX_SHADER","FRAGMENT_SHADER"],n=["","MOZ_","OP_","WEBKIT_"],e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,r){return window.setTimeout(e,1e3/60)},r=window.cancelCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout;return{createProgram:l,createProgramFromScripts:function(e,r,a,t,o){for(var n=[],i=0;i<r.length;++i)n.push(s(e,r[i],e[c[i]],o));return l(e,n,a,t,o)},createShaderFromScriptElement:s,getWebGLContext:function(e,r){return a()&&(o(),e.width=e.clientWidth,e.height=e.clientHeight),function(e,r){if(!window.WebGLRenderingContext)return null;var a=t(e,r);return a}(e,r)},updateCSSIfInIFrame:o,getExtensionWithKnownPrefixes:function(e,r){for(var a=0;a<n.length;++a){var t=n[a]+r,o=e.getExtension(t);if(o)return o}},resizeCanvasToDisplaySize:function(e){e.width==e.clientWidth&&e.height==e.clientHeight||(e.width=e.clientWidth,e.height=e.clientHeight)},requestAnimFrame:e,cancelRequestAnimFrame:r}}},{}]},{},[2]);