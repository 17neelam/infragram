"use strict";var _createClass=function(){function e(e,r){for(var a=0;a<r.length;a++){var n=r[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,a,n){return a&&e(r.prototype,a),n&&e(r,n),r}}(),_slicedToArray=function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var a=[],n=!0,t=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!r||a.length!==r);n=!0);}catch(e){t=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(t)throw o}}return a}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}!function e(r,a,n){function t(i,l){if(!a[i]){if(!r[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=a[i]={exports:{}};r[i][0].call(u.exports,function(e){var a=r[i][1][e];return t(a||e)},u,u.exports,e,r,a,n)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)t(n[i]);return t}({1:[function(e,r,a){r.exports=function(){function e(){var e=window.location.hash;e&&(e=e.split("#")[1]);var r=e.split("&"),a={};return r.forEach(function(e,r){""!=(e=e.split("="))[0]&&(a[e[0]]=e[1])}),a}function r(e){var r=Object.keys(e),a=Object.values(e),n=[];r.forEach(function(e,t){""!=e&&n.push(r[t]+"="+a[t])});var t=n.join("&");window.location.hash=t}return{getUrlHashParameter:function(r){return e()[r]},getUrlHashParameters:e,setUrlHashParameter:function(a,n){var t=e();t[a]=n,r(t)},setUrlHashParameters:r}}},{}],2:[function(e,r,a){window.Infragram=function(r){return(r=r||{}).uploader=r.uploader||!1,r.processor=r.processor||"javascript",r.camera=e("./io/camera")(r),r.processors={webgl:e("./processors/webgl"),javascript:e("./processors/javascript")},r.processor=r.processors[r.processor](),r.logger=e("./logger")(r),{Camera:r.camera,Dispatch:e("./dispatch")(r,r.processor),Interface:e("./interface")(r),logger:r.logger,processors:r.processors,options:r}},r.exports=Infragram},{"./dispatch":5,"./interface":7,"./io/camera":8,"./logger":9,"./processors/javascript":10,"./processors/webgl":11}],3:[function(e,r,a){r.exports=function(r){var a=i([[0,[0,0,0],[255,255,255]],[1,[255,255,255],[255,255,255]]]),n=i([[0,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.75,[255,255,0],[255,50,50]]]),t=i([[0,[0,0,255],[0,0,255]],[.1,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.7,[255,255,0],[255,50,50]],[.9,[255,50,50],[255,50,50]]]),o=e("../util/JsImage.js");function i(e){return function(r){var a,n,t,o,i,l,s,c,u,m,d;m=0,d=0;var g=[e[0][0],1];if(c=g[1],r<(s=g[0]))return m;for(a=n=0,t=e.length;n<t;a=++n){var p=_slicedToArray(e[a],3);if(u=p[0],m=p[1],d=p[2],s=u,a===e.length-1){c=1;break}if(c=e[a+1][0],u<=r&&r<c)break}for(l=[],a=o=0,i=m.length;0<=i?o<i:o>i;a=0<=i?++o:--o)l[a]=(r-s)/(c-s)*(d[a]-m[a])+m[a];return l}}return{colorify:function(e,r){var a,n,t,i,l,s,c,u,m;for($("#btn-colorize").addClass("active"),c=e.width*e.height,n=new Uint8ClampedArray(4*c),l=0,i=s=0,m=c;0<=m?s<m:s>m;i=0<=m?++s:--s){var d=r(e.data[i]),g=_slicedToArray(d,3);u=g[0],t=g[1],a=g[2],n[l++]=u,n[l++]=t,n[l++]=a,n[l++]=255}return new o(n,e.width,e.height,4)},colormap1:n,colormap2:t,greyscale_colormap:a,segmented_colormap:i}}},{"../util/JsImage.js":12}],4:[function(e,r,a){r.exports=window.Converters={hsv2rgb:function(e,r,a){var n,t,o,i,l,s;if([],0===r)l=[a,a,a];else switch(o=a*(1-r),i=a*(1-(n=6*e-(t=Math.floor(6*e)))*r),s=a*(1-(1-n)*r),[a*(1-r),a*(1-r*(e-t)),a*(1-r*(1-(e-t)))],t){case 0:l=[a,s,o];break;case 1:l=[i,a,o];break;case 2:l=[o,a,s];break;case 3:l=[o,i,a];break;case 4:l=[s,o,a];break;default:l=[a,o,i]}return l},rgb2hsv:function(e,r,a){var n,t,o,i,l,s;if(t=s=o=Math.max(e,r,a),n=o-(i=Math.min(e,r,a)),l=0===o?0:n/o,o===i)t=0;else{switch(o){case e:t=(r-a)/n+(r<a?6:0);break;case r:t=(a-e)/n+2;break;case a:t=(e-r)/n+4}t/=6}return[t,l,s]}}},{}],5:[function(e,r,a){r.exports=function(r,a){r.colorized=r.colorized||!1,r.mode=r.mode||"raw",r.video_live=r.video_live||!1,r.webGlSupported=r.webGlSupported||!1;var n=e("./color/colormaps")(),t=r.logger;return r.run_infragrammar=function(e){return t.save_log(),a.runInfragrammar(e)},r.run_colorize=function(){if("webgl"!==a.type){var e=a.getImageData();return a.render(n.colorify(a.infragrammar_mono(e),function(e){return a.colormap((e+1)/2)})),!0}a.glHandleOnClickColor()},{options:r,run_colorize:r.run_colorize,run_infragrammar:r.run_infragrammar}}},{"./color/colormaps":3}],6:[function(require,module,exports){module.exports=window.FileUpload={socket:null,file:null,serverFilename:"",isLoadedFromFile:function(){return!!FileUpload.file},getFilename:function(){return FileUpload.serverFilename},setFilename:function(e){return FileUpload.serverFilename=e},uploadThumbnail:function(e,r){var a;return(a=new Image).onload=function(){var e,a,n;return a=(e=document.createElement("canvas")).getContext("2d"),e.width=260,e.height=195,a.drawImage(this,0,0,this.width,this.height,0,0,e.width,e.height),r=r.toString(),n=e.toDataURL("image/jpeg"),FileUpload.socket.emit("thumbnail_start",{name:FileUpload.serverFilename,data:n,callback:r})},a.src=e},fromFile:function(e,r,a){var n;if(e&&e[0])return $("#file-sel").prop("disabled",!0),$("#save-modal-btn").prop("disabled",!0),FileUpload.file=e[0],FileUpload.file.reader=new FileReader,a&&(FileUpload.file.reader.onload=function(e){return FileUpload.socket.emit("image_send",{name:FileUpload.serverFilename,size:FileUpload.file.size,data:e.target.result})},FileUpload.socket.emit("image_send",{name:e[0].name,size:e[0].size})),FileUpload.file.uploaded=0,(n=new FileReader).onload=function(e){var a;return(a=new Image).onload=function(){return r(this)},a.src=e.target.result},n.readAsDataURL(e[0])},duplicate:function(e){return e=e.toString(),FileUpload.socket.emit("duplicate_start",{name:FileUpload.serverFilename,callback:e})},fromBase64:function(e,r,a){return a=a.toString(),FileUpload.socket.emit("base64_start",{name:e,data:r,callback:a})},initialize:function initialize(options){options=options||{},options.rememberTransport=options.rememberTransport||!1,options.transports=options.transports||["websocket","AJAX long-polling"],options.socket&&(FileUpload.socket=io.connect(window.location.protocol+"//"+window.location.host,options),FileUpload.socket.on("image_request",function(e){var r,a,n;return r=FileUpload.file,n=$("#save-modal-btn").html().split(/\s-\s/g)[0],n+=" - "+Math.round(r.uploaded/r.size*100)+"%",$("#save-modal-btn").html(n),a=r.slice(r.uploaded,r.uploaded+Math.min(e.chunk,r.size-r.uploaded)),FileUpload.file.uploaded+=e.chunk,FileUpload.serverFilename=e.name,r.reader.readAsDataURL(a)}),FileUpload.socket.on("image_done",function(e){var r;return e.error?alert(e.error):FileUpload.serverFilename=e.name,r=$("#save-modal-btn").html().split(/\s-\s/g)[0],$("#save-modal-btn").html(r),$("#file-sel").prop("disabled",!1),$("#save-modal-btn").prop("disabled",!1)}),FileUpload.socket.on("base64_done",function(data){return FileUpload.serverFilename=data.name,eval("var callback="+data.callback),callback()}),FileUpload.socket.on("duplicate_done",function(data){return data.error?alert(data.error):(FileUpload.serverFilename=data.name,eval("var callback="+data.callback),callback())}),FileUpload.socket.on("thumbnail_done",function(data){return eval("var callback="+data.callback),callback()}))}}},{}],7:[function(e,r,a){r.exports=function(r){r.imageSelector=r.imageSelector||"#image-container",r.fileSelector=r.fileSelector||"#file-sel";var a=e("urlhash")(),n=e("./file-upload"),t=r.logger,o=e("./color/colormaps");function i(){return r.mode=$("#modeSwitcher").val(),function(e){if("infragrammar"===r.mode)r.processor.save_expressions(e.r,e.g,e.b);else if("infragrammar_mono"===r.mode)r.processor.save_expressions(e.m,e.m,e.m);else if("infragrammar_hsv"===r.mode)return r.processor.save_expressions_hsv(e.h,e.s,e.v)}({r:$("#r_exp").val(),g:$("#g_exp").val(),b:$("#b_exp").val(),m:$("#m_exp").val(),h:$("#h_exp").val(),s:$("#s_exp").val(),v:$("#v_exp").val()})}$(document).ready(function(){return r.uploadable&&n.initialize({socket:r.uploadable}),$(r.imageSelector).ready(function(){var e,n,t;e="true"===a.getUrlHashParameter("webgl");var o=r.processor.initialize&&r.processor.initialize();return r.webGlSupported=e&&o,r.webGlSupported&&$("#webgl-activate").html("&laquo; Go back to JS version"),n={"#m_exp":"m","#r_exp":"r","#g_exp":"g","#b_exp":"b","#h_exp":"h","#s_exp":"s","#v_exp":"v"},a.setUrlHashParameter(JSON.stringify(n)),(t=a.getUrlHashParameter("src"))&&(params=parametersObject(location.search.split("?")[1]),r.mode=params.mode,fetch_image(t)),!0}),$(r.fileSelector).change(function(){return $("#save-modal-btn").show(),$("#save-zone").show(),n.fromFile(this.files,r.processor.updateImage,r.uploadable),$("#preset-modal").modal("show"),!0}),$("#preset_raw").click(function(){return $("#modeSwitcher").val("infragrammar").change(),$("#r_exp").val("R"),$("#g_exp").val("G"),$("#b_exp").val("B"),$("#preset-modal").modal("hide"),i(),r.webGlSupported?glHandleOnClickRaw():r.run_infragrammar(r.mode)}),$("#preset_ndvi_blue").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),i(),r.webGlSupported?glHandleOnSubmitInfraMono():r.run_infragrammar(r.mode)}),$("#preset_ndvi_blue_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),i(),r.webGlSupported?(glHandleOnClickColor(),glHandleOnClickNdvi()):(r.colorized=!0,r.run_infragrammar(r.mode),r.run_colorize())}),$("#preset_ndvi_red").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),i(),r.webGlSupported?glHandleOnSubmitInfraMono():r.run_infragrammar(r.mode)}),$("#preset_ndvi_red_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),i(),r.webGlSupported?(glHandleOnClickColor(),glHandleOnClickNdvi()):(r.colorized=!0,r.run_infragrammar(r.mode),r.run_colorize())}),$("#btn-colorize").click(function(){return r.webGlSupported?(glHandleOnClickColor(),glHandleOnClickNdvi()):(r.colorized=!0,r.run_infragrammar(r.mode),r.run_colorize())}),$("#default_colormap").click(function(){return r.webGlSupported?(glhandledefaultcolormap(),glhandleonclickndvi()):(r.colorized=!0,o.colormap1,r.run_colorize()),$("#btn-colorize").addClass("active")}),$("#stretched_colormap").click(function(){return r.webGlSupported?(glHandleStretchedColormap(),glHandleOnClickNdvi()):(r.colorized=!0,o.colormap2,r.run_colorize()),$("#btn-colorize").addClass("active")}),$("button#raw").click(function(){return t.log.push("mode=raw"),r.webGlSupported?glHandleOnClickRaw():jsHandleOnClickRaw(),!0}),$("button#ndvi").click(function(){return t.log.push("mode=ndvi"),r.webGlSupported?glHandleOnClickNdvi():jsHandleOnClickNdvi(),!0}),$("button#nir").click(function(){return t.log.push("mode=nir"),$("#m_exp").val("R"),$("#modeSwitcher").val("infragrammar_mono").change(),r.webGlSupported?glHandleOnSubmitInfraMono():jsHandleOnSubmitInfraMono(),!0}),$("#download").click(function(){return downloadImage(),!0}),$("#save").click(function(){var e,r;return r=function(){var e;return e=getCurrentImage(),n.uploadThumbnail(e,function(){return $("#form-filename").val(n.getFilename()),$("#form-log").val(JSON.stringify(t.log)),$("#save-form").submit()})},$("#save").prop("disabled",!0),$("#save").html("Saving..."),""===n.getFilename()?(e=getCurrentImage(),n.fromBase64("camera",e,r)):!1===n.isLoadedFromFile()?n.duplicate(r):r(),!0}),$("#infragrammar_hsv").submit(function(){return r.mode="infragrammar_hsv",t.log_hsv(),i(),r.webGlSupported?glHandleOnSubmitInfraHsv():r.run_infragrammar(r.mode),!0}),$("#infragrammar").submit(function(){return r.mode="infragrammar",t.log_rgb(),i(),r.webGlSupported?glHandleOnSubmitInfra():r.run_infragrammar(r.mode),!0}),$("#infragrammar_mono").submit(function(){return r.mode="infragrammar_mono",t.log_mono(),i(),r.webGlSupported?glHandleOnSubmitInfraMono():r.run_infragrammar(r.mode),!0}),$("button#grey").click(function(){return t.log.push("mode=ndvi"),r.webGlSupported?glHandleOnClickGrey():jsHandleOnClickGrey(),!0}),$("button#colorify").click(function(){return r.webGlSupported?glHandleOnClickColorify():jsHandleOnClickColorify(),!0}),$("button#color").click(function(){return t.log.push("mode=ndvi&color=true"),r.webGlSupported?glHandleOnClickColor():jsHandleOnClickColor(),!0}),$("#webgl-activate").click(function(){var e;return e=window.location.href,r.webGlSupported?e=e.replace(/(?:\?|&)webgl=true/gi,""):e+=e.indexOf("?")>=0?"&webgl=true":"?webgl=true",window.location.href=e,!0}),$("#webcam-activate").click(function(){return $("#save-modal-btn").show(),$("#save-zone").show(),r.camera.initialize(),i(),r.webGlSupported?setInterval(function(){if(image&&r.run_infragrammar(r.mode),r.camera.getSnapshot(),r.colorized)return r.run_colorize()},33):setInterval(function(){if(image&&r.run_infragrammar(r.mode),r.camera.getSnapshot(),r.colorized)return r.run_colorize()},250),$("#preset-modal").modal("show"),!0}),$("#snapshot").click(function(){return r.camera.getSnapshot(),!0}),$("#exit-fullscreen").click(function(){return $("#image").css("display","inline"),$("#image").css("position","relative"),$("#image").css("height","auto"),$("#image").css("left",0),$("#backdrop").hide(),$("#exit-fullscreen").hide(),$("#fullscreen").show(),!0}),$("#fullscreen").click(function(){return $("#image").css("display","block"),$("#image").css("height","100%"),$("#image").css("width","auto"),$("#image").css("position","absolute"),$("#image").css("top","0px"),$("#image").css("left",parseInt((window.innerWidth-$("#image").width())/2)+"px"),$("#image").css("z-index","2"),$("#backdrop").show(),$("#exit-fullscreen").show(),$("#fullscreen").hide(),!0}),$("#modeSwitcher").change(function(){return $("#infragrammar, #infragrammar_mono, #infragrammar_hsv").hide(),$("#"+$("#modeSwitcher").val()).css("display","inline"),!0}),$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),!0})}},{"./color/colormaps":3,"./file-upload":6,urlhash:1}],8:[function(e,r,a){r.exports=function(e){var r,a;var n=e.webRtcOptions||{audio:!1,video:!0,el:"webcam",extern:null,append:!0,width:640,height:480,mode:"callback",debug:function(){},onCapture:function(){return window.webcam.save()},onSave:t,onLoad:function(){}};function t(e){var r,t,o,i,l,s,c,u,m=0;for(r=e.split(""),i=camera.image,c=null,u=n.width,t=n.height,o=l=0,s=u-1;0<=s?l<=s:l>=s;o=0<=s?++l:--l)c=parseInt(r[o],10),i.data[m+0]=c>>16&255,i.data[m+1]=c>>8&255,i.data[m+2]=255&c,i.data[m+3]=255,m+=4;if(m>=4*u*t)return a.putImageData(i,0,0),0}function o(e){var r,a;if("webrtc"===n.context)return a=n.videoEl,r=window.URL||window.webkitURL,navigator.mozGetUserMedia?(a.mozSrcObject=e,console.log("mozilla???")):a.src=r?r.createObjectURL(e):e,a.onerror=function(r){return e.stop()}}function i(e){return alert("No camera available."),console.log(e),console.error("An error occurred: [CODE "+e.code+"]")}return{getSnapshot:function(){var r;return"webrtc"===n.context?(r=document.getElementsByTagName("video")[0],e.processor.updateImage(r),$("#webcam").hide()):"flash"===n.context?window.webcam.capture():void console.log("No context was supplied to getSnapshot()")},initialize:function(){getUserMedia(n,o,i),n.videoEl.setAttribute("autoplay","autoplay"),n.videoEl.setAttribute("playsinline","playsinline"),window.webcam=n,r=e.canvas||document.getElementById("image"),a=r.getContext("2d"),$("#webcam-activate").hide(),$("#snapshot").show(),$("#live-video").show(),$("#webcam").show()},onSaveGetUserMedia:t,webRtcOptions:n}}},{}],9:[function(e,r,a){r.exports=function(e){var r=[];function a(){var a;return a="mode=infragrammar_mono",a+=$("#m_exp").val()?"&m="+$("#m_exp").val():"",a+=e.colorized?"&c=true":"",r.push(a)}function n(){var e;return e="mode=infragrammar_hsv",e+=$("#h_exp").val()?"&h="+$("#h_exp").val():"",e+=$("#s_exp").val()?"&s="+$("#s_exp").val():"",e+=$("#v_exp").val()?"&v="+$("#v_exp").val():"",r.push(e)}function t(){var e;return e="mode=infragrammar",e+=$("#r_exp").val()?"&r="+$("#r_exp").val():"",e+=$("#g_exp").val()?"&g="+$("#g_exp").val():"",e+=$("#b_exp").val()?"&b="+$("#b_exp").val():"",r.push(e)}return{log:r,log_hsv:n,log_mono:a,log_rgb:t,save_log:function(){return"infragrammar_mono"===e.mode?a():"infragrammar_hsv"===e.mode?n():"infragrammar"===e.mode?t():void 0}}}},{}],10:[function(require,module,exports){module.exports=function javascriptProcessor(){var b_exp="",g_exp="",get_channels,Colormaps=require("../color/colormaps")(JsImage),colormap=Colormaps.colormap1,converters=require("../color/converters"),image=null,jsHandleOnClickGrey,jsHandleOnClickNdvi,jsHandleOnClickRaw,jsHandleOnSlide,jsHandleOnSubmitInfra,jsHandleOnSubmitInfraHsv,jsHandleOnSubmitInfraMono,m_exp="",mode="raw",ndvi,r_exp="",set_mode,update_colorbar,JsImage=require("../util/JsImage.js");function histogram(e,r,a){var n,t,o,i,l,s,c=_slicedToArray(r,2),u=c[0],m=c[1];for(t=function(){var e,r,n;for(n=[],i=e=0,r=a;0<=r?e<r:e>r;i=0<=r?++e:--e)n.push(0);return n}(),o=(m-u)/a,l=0,s=e.length;l<s;l++)n=e[l],0<=(i=Math.floor((n-u)/o))&&i<a&&t[i]++;return t}function get_channels(e){var r,a,n,t,o,i,l,s;for(i=e.width*e.height,l=new Float32Array(i),a=new Float32Array(i),r=new Float32Array(i),n=t=0,s=i;0<=s?t<s:t>s;n=0<=s?++t:--t)l[n]=e.data[4*n+0],a[n]=e.data[4*n+1],r[n]=e.data[4*n+2];function o(r){return new JsImage(r,e.width,e.height,1)}return[o(l),o(a),o(r)]}function ndvi(e,r){var a,n,t,o,i;for(o=e.width*e.height,a=new Float64Array(o),n=t=0,i=o;0<=i?t<i:t>i;n=0<=i?++t:--t)a[n]=(e.data[n]-r.data[n])/(e.data[n]+r.data[n]);return new JsImage(a,e.width,e.height,1)}function infragrammar(e){var r,a,n,t,o,i,l,s;for($("#btn-colorize").removeClass("active"),o=e.width*e.height,l=new Float32Array(o),a=new Float32Array(o),r=new Float32Array(o),i=new Float32Array(4*o),n=t=0,s=o;0<=s?t<s:t>s;n=0<=s?++t:--t)l[n]=e.data[4*n+0]/255,a[n]=e.data[4*n+1]/255,r[n]=e.data[4*n+2]/255,i[4*n+0]=255*r_exp(l[n],a[n],r[n]),i[4*n+1]=255*g_exp(l[n],a[n],r[n]),i[4*n+2]=255*b_exp(l[n],a[n],r[n]),i[4*n+3]=255;return new JsImage(i,e.width,e.height,4)}function infragrammar_mono(e){var r,a,n,t,o,i,l,s;for(o=e.width*e.height,l=new Float32Array(o),a=new Float32Array(o),r=new Float32Array(o),i=new Float32Array(o),n=t=0,s=o;0<=s?t<s:t>s;n=0<=s?++t:--t)l[n]=e.data[4*n+0]/255,a[n]=e.data[4*n+1]/255,r[n]=e.data[4*n+2]/255,i[n]=r_exp(l[n],a[n],r[n]);return new JsImage(i,e.width,e.height,1)}function render(e){var r,a,n;return(n=$("#image")[0]).width=e.width,n.height=e.height,a=(r=n.getContext("2d")).getImageData(0,0,e.width,e.height),e.copyToImageData(a),r.putImageData(a,0,0)}function update(e){var r,a,n,t,o,i;if($("#colorbar-container")[0].style.display="none","ndvi"===mode){var l=get_channels(e),s=_slicedToArray(l,3);o=s[0],s[1],r=s[2],t=ndvi(o,r),n=-1,a=1,i=Colormaps.colorify(t,function(e){return colormap((e-n)/(a-n))}),update_colorbar(n,a)}else if("raw"===mode)i=new JsImage(e.data,e.width,e.height,4);else if("nir"===mode){var c=get_channels(e),u=_slicedToArray(c,3);o=u[0],u[1],r=u[2],i=Colormaps.colorify(o,function(e){return[e,e,e]})}else i=infragrammar(e);return render(i)}function save_expressions(r,g,b){return""===r&&(r="R"),""===g&&(g="G"),""===b&&(b="B"),eval("r_exp = function(R,G,B){var r=R,g=G,b=B;return "+r+";}"),eval("g_exp = function(R,G,B){var r=R,g=G,b=B;return "+g+";}"),eval("b_exp = function(R,G,B){var r=R,g=G,b=B;return "+b+";}")}function save_expressions_hsv(h,s,v){return""===h&&(h="H"),""===s&&(s="S"),""===v&&(v="V"),eval("r_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[0];}"),eval("g_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[1];}"),eval("b_exp = function(R,G,B){var h=H,s=S,v=V,hsv = converters.rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return converters.hsv2rgb("+h+","+s+","+v+")[2];}")}function getImageData(){var e=$("#image")[0].getContext("2d"),r=$("#image").width(),a=$("#image").height();return image||e.getImageData(0,0,r,a)}function getJsImage(){var e=getImageData();return new JsImage(e.data,e.width,e.height,1)}function set_mode(e){return mode=e,update(getImageData()),"ndvi"===mode?$("#colormaps-group")[0].style.display="inline-block":$("#colormaps-group").length>0?$("#colormaps-group")[0].style.display="none":void 0}function updateImage(e){var r,a,n,t;return r=(n=document.getElementById("image")).getContext("2d"),t=e.videoWidth||e.width,a=e.videoHeight||e.height,r.drawImage(e,0,0,t,a,0,0,n.width,n.height),image=r.getImageData(0,0,n.width,n.height),set_mode(mode)}function runInfragrammar(e){return set_mode(e)}function getCurrentImage(){return $("#image")[0].getContext("2d").canvas.toDataURL("image/jpeg")}return update_colorbar=function(e,r){var a,n,t,o,i,l,s,c,u,m,d,g,p;for($("#colorbar-container")[0].style.display="inline-block",t=(n=(o=$("#colorbar")[0]).getContext("2d")).getImageData(0,0,o.width,o.height),l=u=0,g=o.width;0<=g?u<g:u>g;l=0<=g?++u:--u)for(s=m=0,p=o.height;0<=p?m<p:m>p;s=0<=p?++m:--m){var f=colormap(l/o.width),h=_slicedToArray(f,3);d=h[0],i=h[1],a=h[2],c=4*(l+s*o.width),t.data[c+0]=d,t.data[c+1]=i,t.data[c+2]=a,t.data[c+3]=255}return n.putImageData(t,0,0),$("#colorbar-min")[0].textContent=e.toFixed(2),$("#colorbar-max")[0].textContent=r.toFixed(2)},jsHandleOnClickRaw=function(){return set_mode("raw")},jsHandleOnClickNdvi=function(){return set_mode("ndvi")},jsHandleOnSubmitInfraHsv=function(){return save_expressions_hsv($("#h_exp").val(),$("#s_exp").val(),$("#v_exp").val()),set_mode("infragrammar_hsv")},jsHandleOnSubmitInfra=function(){return save_expressions($("#r_exp").val(),$("#g_exp").val(),$("#b_exp").val()),set_mode("infragrammar")},jsHandleOnSubmitInfraMono=function(){return save_expressions($("#m_exp").val(),$("#m_exp").val(),$("#m_exp").val()),set_mode("infragrammar_mono")},jsHandleOnClickGrey=function(){return colormap=Colormaps.greyscale_colormap,update(image)},{type:"javascript",colormap:colormap,getCurrentImage:getCurrentImage,getImageData:getImageData,getJsImage:getJsImage,infragrammar_mono:infragrammar_mono,infragrammar:infragrammar,render:render,runInfragrammar:runInfragrammar,save_expressions:save_expressions,save_expressions_hsv:save_expressions_hsv,update:update,updateImage:updateImage}}},{"../color/colormaps":3,"../color/converters":4,"../util/JsImage.js":12}],11:[function(e,r,a){r.exports=function(){var r=null,a=null,n=[-1,-1,-1,1,1,-1,1,1],t=0,o=e("../util/webgl-utils")();function i(e,r,a,t,i){var l,s,c,m,d,g,p,f;return(l=new Object).mode=e,l.expression=["","",""],l.selColormap=r,l.colormap=a,l.slider=t,l.updateShader=!0,l.canvas=document.getElementById(i),l.canvas.addEventListener("webglcontextlost",function(e){return e.preventDefault()},!1),l.canvas.addEventListener("webglcontextrestored",u,!1),l.gl=o.getWebGLContext(l.canvas),l.gl?(l.gl.getExtension("OES_texture_float"),l.vertexBuffer=(g=n,p=(f=l.gl).createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,p),f.bufferData(f.ARRAY_BUFFER,new Float32Array(g),f.STATIC_DRAW),p.itemSize=g.itemSize,p),l.framebuffer=l.gl.createFramebuffer(),l.imageTexture=(s=l,c=l.gl.TEXTURE0,d=(m=s.gl).createTexture(),m.activeTexture(c),m.bindTexture(m.TEXTURE_2D,d),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!0),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,s.canvas.width,s.canvas.height,0,m.RGBA,m.UNSIGNED_BYTE,null),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),d),l):null}function l(e,r){var a,t,i,s,c,u,m,d;if(r||window.requestAnimationFrame(function(){return l(e,!1)}),e.updateShader&&(e.updateShader=!1,function(e){var r,a,n,t;console.log("generateShader");var i=_slicedToArray(e.expression,3);t=i[0],n=i[1],r=i[2],t=t.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),n=n.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),r=r.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),t=t.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),n=n.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),r=r.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),t=t.replace(/([0-9])([^\.])?/g,"$1.0$2"),n=n.replace(/([0-9])([^\.])?/g,"$1.0$2"),r=r.replace(/([0-9])([^\.])?/g,"$1.0$2"),"ndvi"===e.mode&&(""!==t&&(t="(("+t+") + 1.0) / 2.0"),""!==n&&(n="(("+n+") + 1.0) / 2.0"),""!==r&&(r="(("+r+") + 1.0) / 2.0"));""===t&&(t="r");""===n&&(n="g");""===r&&(r="b");a=(a=(a=(a=$("#shader-fs-template").html()).replace(/@1@/g,t)).replace(/@2@/g,n)).replace(/@3@/g,r),$("#shader-fs").html(a),e.shaderProgram=o.createProgramFromScripts(e.gl,["shader-vs","shader-fs"])}(e)),(a=e.gl).viewport(0,0,e.canvas.width,e.canvas.height),a.useProgram(e.shaderProgram),a.bindBuffer(a.ARRAY_BUFFER,e.vertexBuffer),d=a.getAttribLocation(e.shaderProgram,"aVertexPosition"),a.enableVertexAttribArray(d),a.vertexAttribPointer(d,e.vertexBuffer.itemSize,a.FLOAT,!1,0,0),c=a.getUniformLocation(e.shaderProgram,"uSampler"),a.uniform1i(c,0),m=a.getUniformLocation(e.shaderProgram,"uSlider"),a.uniform1f(m,e.slider),s=a.getUniformLocation(e.shaderProgram,"uNdvi"),a.uniform1i(s,"ndvi"===e.mode||e.colormap?1:0),u=a.getUniformLocation(e.shaderProgram,"uSelectColormap"),a.uniform1i(u,e.selColormap),i=a.getUniformLocation(e.shaderProgram,"uHsv"),a.uniform1i(i,"hsv"===e.mode?1:0),t=a.getUniformLocation(e.shaderProgram,"uColormap"),a.uniform1i(t,e.colormap?1:0),a.drawArrays(a.TRIANGLE_STRIP,0,n.length/n.itemSize),r)return e.canvas.toDataURL("image/jpeg")}function s(e,r){return console.log("setMode",r),e.mode!=r&&(e.updateShader=!0),e.mode=r,"ndvi"===e.mode?($("#colorbar-container")[0].style.display="inline-block",$("#colormaps-group")[0].style.display="inline-block"):($("#colorbar-container")[0].style.display="none",$("#colormaps-group")[0].style.display="none")}function c(){if(!(t-=1))return l(r),l(a)}function u(){var e;if(e=r.imageData,r=i(r.mode,r.selColormap,r.colormap,r.slider,"image"),a=i(a.mode,a.selColormap,a.colormap,a.slider,"colorbar"),r&&a)return m(e)}function m(e){var a;return a=r.gl,r.imageData=e,a.activeTexture(a.TEXTURE0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e)}return n.itemSize=2,{type:"webgl",initialize:function(){return r=i("raw",1,0,1,"image"),a=i("raw",1,1,1,"colorbar"),t=2,$("#shader-vs").load("dist/shader.vert",c),$("#shader-fs-template").load("dist/shader.frag",c),!(!r||!a)},getCurrentImage:function(){return l(r,!0)},getImageData:function(){return r.imageData},runInfragrammar:function(e){return s(r,"ndvi")},save_expressions:function(e,a,n){return r.expression=[e,a,n]},setMode:s,updateImage:m,glHandleOnClickColor:function(){return r.selColormap=a.selColormap=0}}}},{"../util/webgl-utils":13}],12:[function(e,r,a){r.exports=function(){function e(r,a,n,t){_classCallCheck(this,e),this.data=r,this.width=a,this.height=n,this.channels=t}return _createClass(e,[{key:"copyToImageData",value:function(e){return e.data.set(this.data)}},{key:"extrema",value:function(){var e,r,a,n,t,o,i,l,s,c;for(l=this.width*this.height,i=function(){var e,a,n;for(n=[],r=e=0,a=this.channels;0<=a?e<a:e>a;r=0<=a?++e:--e)n.push(this.data[r]);return n}.call(this),o=function(){var e,a,n;for(n=[],r=e=0,a=this.channels;0<=a?e<a:e>a;r=0<=a?++e:--e)n.push(this.data[r]);return n}.call(this),a=0,r=n=0,s=l;0<=s?n<s:n>s;r=0<=s?++n:--n)for(e=t=0,c=this.channels;0<=c?t<c:t>c;e=0<=c?++t:--t)this.data[a]>o[e]&&(o[e]=this.data[a]),this.data[a]<i[e]&&(i[e]=this.data[a]),a++;return[i,o]}}]),e}()},{}],13:[function(e,r,a){r.exports=function(){var e=function(e){window.console&&(window.console.error?window.console.error(e):window.console.log&&window.console.log(e))},r=function(){return window!=window.top},a=function(e,r){for(var a=["webgl","experimental-webgl"],n=null,t=0;t<a.length;++t){try{n=e.getContext(a[t],r)}catch(e){}if(n)break}return n},n=function(){r()&&(document.body.className="iframe")},t=function(r,a,n,t,o){for(var i=o||e,l=r.createProgram(),s=0;s<a.length;++s)r.attachShader(l,a[s]);if(n)for(s=0;s<n.length;++s)r.bindAttribLocation(l,t?t[s]:s,n[s]);return r.linkProgram(l),r.getProgramParameter(l,r.LINK_STATUS)?l:(lastError=r.getProgramInfoLog(l),i("Error in program linking:"+lastError),r.deleteProgram(l),null)},o=function(r,a,n,t){var o,i,l,s,c,u,m,d=document.getElementById(a);if(!d)throw"*** Error: unknown script element"+a;if(o=d.text,!n)if("x-shader/x-vertex"==d.type)i=r.VERTEX_SHADER;else if("x-shader/x-fragment"==d.type)i=r.FRAGMENT_SHADER;else if(i!=r.VERTEX_SHADER&&i!=r.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return s=o,c=n||i,u=t||e,m=(l=r).createShader(c),l.shaderSource(m,s),l.compileShader(m),l.getShaderParameter(m,l.COMPILE_STATUS)?m:(lastError=l.getShaderInfoLog(m),u("*** Error compiling shader '"+m+"':"+lastError),l.deleteShader(m),null)},i=["VERTEX_SHADER","FRAGMENT_SHADER"],l=["","MOZ_","OP_","WEBKIT_"],s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,r){return window.setTimeout(e,1e3/60)},c=window.cancelCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout;return{createProgram:t,createProgramFromScripts:function(e,r,a,n,l){for(var s=[],c=0;c<r.length;++c)s.push(o(e,r[c],e[i[c]],l));return t(e,s,a,n,l)},createShaderFromScriptElement:o,getWebGLContext:function(e,t){return r()&&(n(),e.width=e.clientWidth,e.height=e.clientHeight),function(e,r){if(!window.WebGLRenderingContext)return null;var n=a(e,r);return n}(e,t)},updateCSSIfInIFrame:n,getExtensionWithKnownPrefixes:function(e,r){for(var a=0;a<l.length;++a){var n=l[a]+r,t=e.getExtension(n);if(t)return t}},resizeCanvasToDisplaySize:function(e){e.width==e.clientWidth&&e.height==e.clientHeight||(e.width=e.clientWidth,e.height=e.clientHeight)},requestAnimFrame:s,cancelRequestAnimFrame:c}}},{}]},{},[2]);