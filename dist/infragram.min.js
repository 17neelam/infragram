!function e(r,a,n){function o(i,l){if(!a[i]){if(!r[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(t)return t(i,!0);var m=new Error("Cannot find module '"+i+"'");throw m.code="MODULE_NOT_FOUND",m}var c=a[i]={exports:{}};r[i][0].call(c.exports,function(e){var a=r[i][1][e];return o(a||e)},c,c.exports,e,r,a,n)}return a[i].exports}for(var t="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,r,a){r.exports=function(){function e(){var e=window.location.hash;e&&(e=e.split("#")[1]);var r={};return e.split("&").forEach(function(e,a){""!=(e=e.split("="))[0]&&(r[e[0]]=e[1])}),r}function r(e){var r=Object.keys(e),a=Object.values(e),n=[];r.forEach(function(e,o){""!=e&&n.push(r[o]+"="+a[o])});var o=n.join("&");window.location.hash=o}return{getUrlHashParameter:function(r){return e()[r]},getUrlHashParameters:e,setUrlHashParameter:function(a,n){var o=e();o[a]=n,r(o)},setUrlHashParameters:r}}},{}],2:[function(e,r,a){Infragram=function(r){return r=r||{},r.uploader=r.uploader||!1,r.processors={webgl:e("./processors/webgl"),javascript:e("./processors/javascript")},r.processor=r.processor||"javascript",r.processor=r.processors[r.processor](),{Dispatch:e("./dispatch")(r,r.processor),Interface:e("./interface")(r),processors:r.processors}},r.exports=Infragram},{"./dispatch":3,"./interface":5,"./processors/javascript":6,"./processors/webgl":7}],3:[function(e,r,a){r.exports=function(e,r){function a(){var r;return r="mode=infragrammar_mono",r+=$("#m_exp").val()?"&m="+$("#m_exp").val():"",r+=e.colorized?"&c=true":"",i.push(r)}function n(){var e;return e="mode=infragrammar_hsv",e+=$("#h_exp").val()?"&h="+$("#h_exp").val():"",e+=$("#s_exp").val()?"&s="+$("#s_exp").val():"",e+=$("#v_exp").val()?"&v="+$("#v_exp").val():"",i.push(e)}function o(){var e;return e="mode=infragrammar",e+=$("#r_exp").val()?"&r="+$("#r_exp").val():"",e+=$("#g_exp").val()?"&g="+$("#g_exp").val():"",e+=$("#b_exp").val()?"&b="+$("#b_exp").val():"",i.push(e)}function t(){return"infragrammar_mono"===mode?a():"infragrammar_hsv"===mode?n():"infragrammar"===mode?o():void 0}e.colorized=e.colorized||!1,e.mode=e.mode||"raw",e.video_live=e.video_live||!1,e.webGlSupported=e.webGlSupported||!1;var i=[];return e.run_infragrammar=function(a){return t(),e.colorized=!1,r.runInfragrammar(a)},e.run_colorize=function(){return r.colorify&&render(r.colorify(infragrammar_mono(image),function(e){return colormap((e+1)/2)})),!0},e.save_infragrammar_inputs=function(){return mode=$("#modeSwitcher").val(),e.save_infragrammar_expressions({r:$("#r_exp").val(),g:$("#g_exp").val(),b:$("#b_exp").val(),m:$("#m_exp").val(),h:$("#h_exp").val(),s:$("#s_exp").val(),v:$("#v_exp").val()})},e.save_infragrammar_expressions=function(e){if("infragrammar"===mode)r.save_expressions(e.r,e.g,e.b);else if("infragrammar_mono"===mode)r.save_expressions(e.m,e.m,e.m);else if("infragrammar_hsv"===mode)return r.save_expressions_hsv(e.h,e.s,e.v)},{downloadImage:function(){var r,a,n;return n=document.createElement("a"),n.href=e.processor.getCurrentImage(),a=n.href.match("image/jpeg")?"jpg":"png",n.download=(new Date).toISOString().replace(/:/g,"_")+"."+a,document.createEvent?((r=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r)):n.fireEvent&&n.fireEvent("onclick"),!0},fetch_image:function(r,a){var n;return $("#save-modal-btn").show(),$("#save-zone").show(),n=new Image,e.uploader&&(n.onload=function(){var n;if(n=r.split("/"),n=n[n.length-1],FileUpload.setFilename(n),a&&("infra"===a.substring(0,5)?$("#modeSwitcher").val(a).change():($("button#"+a).button("toggle"),$("button#"+a).click())),e.save_infragrammar_expressions(params),"ndvi"===a?(e.save_infragrammar_expressions({m:"(R-B)/(R+B)"}),a="infragrammar_mono"):"nir"===a?(e.save_infragrammar_expressions({m:"R"}),a="infragrammar_mono"):"raw"===a&&(e.save_infragrammar_expressions({r:"R",g:"G",b:"B"}),a="infragrammar"),e.processor.updateImage(this),"true"!==params.color&&"true"!==params.c||(e.colorized=!0),run_infragrammar(a),"true"!==params.color&&"true"!==params.c||(e.colorized=!0),e.colorized)return $("button#color").button("toggle"),run_colorize()}),n.src=r},log:i,log_hsv:n,log_mono:a,log_rgb:o,run_colorize:e.run_colorize,run_infragrammar:e.run_infragrammar,save_infragrammar_expressions:e.save_infragrammar_expressions,save_infragrammar_inputs:e.save_infragrammar_inputs,save_log:t}}},{}],4:[function(require,module,exports){module.exports=FileUpload={socket:null,file:null,serverFilename:"",isLoadedFromFile:function(){return!!FileUpload.file},getFilename:function(){return FileUpload.serverFilename},setFilename:function(e){return FileUpload.serverFilename=e},uploadThumbnail:function(e,r){var a;return a=new Image,a.onload=function(){var e,a,n;return e=document.createElement("canvas"),a=e.getContext("2d"),e.width=260,e.height=195,a.drawImage(this,0,0,this.width,this.height,0,0,e.width,e.height),r=r.toString(),n=e.toDataURL("image/jpeg"),FileUpload.socket.emit("thumbnail_start",{name:FileUpload.serverFilename,data:n,callback:r})},a.src=e},fromFile:function(e,r,a){var n;if(e&&e[0])return $("#file-sel").prop("disabled",!0),$("#save-modal-btn").prop("disabled",!0),FileUpload.file=e[0],FileUpload.file.reader=new FileReader,a&&(FileUpload.file.reader.onload=function(e){return FileUpload.socket.emit("image_send",{name:FileUpload.serverFilename,size:FileUpload.file.size,data:e.target.result})},FileUpload.socket.emit("image_send",{name:e[0].name,size:e[0].size})),FileUpload.file.uploaded=0,n=new FileReader,n.onload=function(e){var a;return a=new Image,a.onload=function(){return r(this)},a.src=e.target.result},n.readAsDataURL(e[0])},duplicate:function(e){return e=e.toString(),FileUpload.socket.emit("duplicate_start",{name:FileUpload.serverFilename,callback:e})},fromBase64:function(e,r,a){return a=a.toString(),FileUpload.socket.emit("base64_start",{name:e,data:r,callback:a})},initialize:function(options){options=options||{},options.rememberTransport=options.rememberTransport||!1,options.transports=options.transports||["websocket","AJAX long-polling"],options.socket&&(FileUpload.socket=io.connect(window.location.protocol+"//"+window.location.host,options),FileUpload.socket.on("image_request",function(e){var r,a,n;return r=FileUpload.file,n=$("#save-modal-btn").html().split(/\s-\s/g)[0],n+=" - "+Math.round(r.uploaded/r.size*100)+"%",$("#save-modal-btn").html(n),a=r.slice(r.uploaded,r.uploaded+Math.min(e.chunk,r.size-r.uploaded)),FileUpload.file.uploaded+=e.chunk,FileUpload.serverFilename=e.name,r.reader.readAsDataURL(a)}),FileUpload.socket.on("image_done",function(e){var r;return e.error?alert(e.error):FileUpload.serverFilename=e.name,r=$("#save-modal-btn").html().split(/\s-\s/g)[0],$("#save-modal-btn").html(r),$("#file-sel").prop("disabled",!1),$("#save-modal-btn").prop("disabled",!1)}),FileUpload.socket.on("base64_done",function(data){return FileUpload.serverFilename=data.name,eval("var callback="+data.callback),callback()}),FileUpload.socket.on("duplicate_done",function(data){return data.error?alert(data.error):(FileUpload.serverFilename=data.name,eval("var callback="+data.callback),callback())}),FileUpload.socket.on("thumbnail_done",function(data){return eval("var callback="+data.callback),callback()}))}}},{}],5:[function(e,r,a){r.exports=function(r){var a=e("urlhash")(),n=e("./file-upload");$(document).ready(function(){return r.uploadable&&n.initialize({socket:r.uploadable}),$("#image-container").ready(function(){var e,r,n;return e="true"===a.getUrlHashParameter("webgl"),webGlSupported=e&&glInitInfragram(),webGlSupported&&$("#webgl-activate").html("&laquo; Go back to JS version"),r={"#m_exp":"m","#r_exp":"r","#g_exp":"g","#b_exp":"b","#h_exp":"h","#s_exp":"s","#v_exp":"v"},a.setUrlHashParameter(r),(n=a.getUrlHashParameter("src"))&&(params=parametersObject(location.search.split("?")[1]),mode=params.mode,fetch_image(n)),!0}),$("#file-sel").change(function(){return $("#save-modal-btn").show(),$("#save-zone").show(),n.fromFile(this.files,r.processor.updateImage,r.uploadable),$("#preset-modal").modal("show"),!0}),$("#preset_raw").click(function(){return $("#modeSwitcher").val("infragrammar").change(),$("#r_exp").val("R"),$("#g_exp").val("G"),$("#b_exp").val("B"),$("#preset-modal").modal("hide"),r.save_infragrammar_inputs(),webGlSupported?glHandleOnClickRaw():r.run_infragrammar(mode)}),$("#preset_ndvi_blue").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),r.save_infragrammar_inputs(),webGlSupported?glHandleOnSubmitInfraMono():r.run_infragrammar(mode)}),$("#preset_ndvi_blue_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(R-B)/(R+B)"),$("#preset-modal").modal("hide"),r.save_infragrammar_inputs(),webGlSupported?(glHandleOnClickColor(),glHandleOnClickNdvi()):(r.colorized=!0,r.run_infragrammar(mode),r.run_colorize())}),$("#preset_ndvi_red").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),r.save_infragrammar_inputs(),webGlSupported?glHandleOnSubmitInfraMono():r.run_infragrammar(mode)}),$("#preset_ndvi_red_color").click(function(){return $("#modeSwitcher").val("infragrammar_mono").change(),$("#m_exp").val("(B-R)/(B+R)"),$("#preset-modal").modal("hide"),r.save_infragrammar_inputs(),webGlSupported?(glHandleOnClickColor(),glHandleOnClickNdvi()):(r.colorized=!0,r.run_infragrammar(mode),r.run_colorize())}),$("#btn-colorize").click(function(){return webGlSupported?(glHandleOnClickColor(),glHandleOnClickNdvi()):(r.colorized=!0,r.run_infragrammar(mode),run_colorize())}),$("#default_colormap").click(function(){return webglsupported?(glhandledefaultcolormap(),glhandleonclickndvi()):(r.colorized=!0,colormap1,r.run_colorize()),$("#btn-colorize").addClass("active")}),$("#stretched_colormap").click(function(){return webGlSupported?(glHandleStretchedColormap(),glHandleOnClickNdvi()):(r.colorized=!0,colormap2,r.run_colorize()),$("#btn-colorize").addClass("active")}),$("button#raw").click(function(){return log.push("mode=raw"),webGlSupported?glHandleOnClickRaw():jsHandleOnClickRaw(),!0}),$("button#ndvi").click(function(){return log.push("mode=ndvi"),webGlSupported?glHandleOnClickNdvi():jsHandleOnClickNdvi(),!0}),$("button#nir").click(function(){return log.push("mode=nir"),$("#m_exp").val("R"),$("#modeSwitcher").val("infragrammar_mono").change(),webGlSupported?glHandleOnSubmitInfraMono():jsHandleOnSubmitInfraMono(),!0}),$("#download").click(function(){return downloadImage(),!0}),$("#save").click(function(){var e,r;return r=function(){var e;return e=getCurrentImage(),n.uploadThumbnail(e,function(){return $("#form-filename").val(n.getFilename()),$("#form-log").val(JSON.stringify(log)),$("#save-form").submit()})},$("#save").prop("disabled",!0),$("#save").html("Saving..."),""===n.getFilename()?(e=getCurrentImage(),n.fromBase64("camera",e,r)):!1===n.isLoadedFromFile()?n.duplicate(r):r(),!0}),$("#infragrammar_hsv").submit(function(){return mode="infragrammar_hsv",log_hsv(),r.save_infragrammar_inputs(),webGlSupported?glHandleOnSubmitInfraHsv():r.run_infragrammar(mode),!0}),$("#infragrammar").submit(function(){return mode="infragrammar",log_rgb(),r.save_infragrammar_inputs(),webGlSupported?glHandleOnSubmitInfra():r.run_infragrammar(mode),!0}),$("#infragrammar_mono").submit(function(){return mode="infragrammar_mono",log_mono(),r.save_infragrammar_inputs(),webGlSupported?glHandleOnSubmitInfraMono():r.run_infragrammar(mode),!0}),$("button#grey").click(function(){return log.push("mode=ndvi"),webGlSupported?glHandleOnClickGrey():jsHandleOnClickGrey(),!0}),$("button#colorify").click(function(){return webGlSupported?glHandleOnClickColorify():jsHandleOnClickColorify(),!0}),$("button#color").click(function(){return log.push("mode=ndvi&color=true"),webGlSupported?glHandleOnClickColor():jsHandleOnClickColor(),!0}),$("#slider").slider().on("slide",function(e){return webGlSupported?glHandleOnSlide(e):jsHandleOnSlide(e),!0}),$("#webgl-activate").click(function(){var e;return e=window.location.href,webGlSupported?e=e.replace(/(?:\?|&)webgl=true/gi,""):e+=e.indexOf("?")>=0?"&webgl=true":"?webgl=true",window.location.href=e,!0}),$("#webcam-activate").click(function(){return $("#save-modal-btn").show(),$("#save-zone").show(),camera.initialize(),r.save_infragrammar_inputs(),webGlSupported?setInterval(function(){if(image&&video_live&&(r.run_infragrammar(mode),video_live=!0),camera.getSnapshot(),r.colorized)return r.run_colorize()},33):setInterval(function(){if(image&&video_live&&(r.run_infragrammar(mode),video_live=!0),camera.getSnapshot(),r.colorized)return run_colorize()},250),$("#preset-modal").modal("show"),!0}),$("#snapshot").click(function(){return camera.getSnapshot(),!0}),$("#exit-fullscreen").click(function(){return $("#image").css("display","inline"),$("#image").css("position","relative"),$("#image").css("height","auto"),$("#image").css("left",0),$("#backdrop").hide(),$("#exit-fullscreen").hide(),$("#fullscreen").show(),!0}),$("#fullscreen").click(function(){return $("#image").css("display","block"),$("#image").css("height","100%"),$("#image").css("width","auto"),$("#image").css("position","absolute"),$("#image").css("top","0px"),$("#image").css("left",parseInt((window.innerWidth-$("#image").width())/2)+"px"),$("#image").css("z-index","2"),$("#backdrop").show(),$("#exit-fullscreen").show(),$("#fullscreen").hide(),!0}),$("#modeSwitcher").change(function(){return $("#infragrammar, #infragrammar_mono, #infragrammar_hsv").hide(),$("#"+$("#modeSwitcher").val()).css("display","inline"),!0}),$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),!0})}},{"./file-upload":4,urlhash:1}],6:[function(require,module,exports){module.exports=function javascriptProcessor(){function colorify(e,r){var a,n,o,t,i,l,s,m,c,d;for($("#btn-colorize").addClass("active"),m=e.width*e.height,o=new Uint8ClampedArray(4*m),l=0,i=s=0,d=m;0<=d?s<d:s>d;i=0<=d?++s:--s)[c,t,a]=r(e.data[i]),o[l++]=c,o[l++]=t,o[l++]=a,o[l++]=255;return n=new JsImage,n.width=e.width,n.height=e.height,n.data=o,new JsImage(o,e.width,e.height,4)}function infragrammar(e){var r,a,n,o,t,i,l,s;for($("#btn-colorize").removeClass("active"),t=e.width*e.height,l=new Float32Array(t),a=new Float32Array(t),r=new Float32Array(t),i=new Float32Array(4*t),n=o=0,s=t;0<=s?o<s:o>s;n=0<=s?++o:--o)l[n]=e.data[4*n+0]/255,a[n]=e.data[4*n+1]/255,r[n]=e.data[4*n+2]/255,i[4*n+0]=255*r_exp(l[n],a[n],r[n]),i[4*n+1]=255*g_exp(l[n],a[n],r[n]),i[4*n+2]=255*b_exp(l[n],a[n],r[n]),i[4*n+3]=255;return new JsImage(i,e.width,e.height,4)}function infragrammar_mono(e){var r,a,n,o,t,i,l,s;for(t=e.width*e.height,l=new Float32Array(t),a=new Float32Array(t),r=new Float32Array(t),i=new Float32Array(t),n=o=0,s=t;0<=s?o<s:o>s;n=0<=s?++o:--o)l[n]=e.data[4*n+0]/255,a[n]=e.data[4*n+1]/255,r[n]=e.data[4*n+2]/255,i[n]=r_exp(l[n],a[n],r[n]);return new JsImage(i,e.width,e.height,1)}function render(e){var r,a,n;return n=$("#image")[0],n.width=e.width,n.height=e.height,r=n.getContext("2d"),a=r.getImageData(0,0,e.width,e.height),e.copyToImageData(a),r.putImageData(a,0,0)}function set_mode(e){return mode=e,update(image),"ndvi"===mode?$("#colormaps-group")[0].style.display="inline-block":$("#colormaps-group").size()>0?$("#colormaps-group")[0].style.display="none":void 0}function updateImage(e){var r,a,n,o;return n=document.getElementById("image"),r=n.getContext("2d"),o=e.videoWidth||e.width,a=e.videoHeight||e.height,r.drawImage(e,0,0,o,a,0,0,n.width,n.height),image=r.getImageData(0,0,n.width,n.height),set_mode(mode)}function runInfragrammar(e){return set_mode(e)}function getCurrentImage(){var e;return e=$("#image")[0],e.getContext("2d").canvas.toDataURL("image/jpeg")}var JsImage,b_exp="",colormap,colormap1,colormap2,g_exp="",get_channels,greyscale_colormap,histogram,hsv2rgb,image=null,infragrammar,infragrammar_mono,jsHandleOnClickGrey,jsHandleOnClickNdvi,jsHandleOnClickRaw,jsHandleOnSlide,jsHandleOnSubmitInfra,jsHandleOnSubmitInfraHsv,jsHandleOnSubmitInfraMono,m_exp="",mode="raw",ndvi,r_exp="",render,rgb2hsv,segmented_colormap,set_mode,update,update_colorbar;return JsImage=class{constructor(e,r,a,n){this.data=e,this.width=r,this.height=a,this.channels=n}copyToImageData(e){return e.data.set(this.data)}extrema(){var e,r,a,n,o,t,i,l,s,m;for(l=this.width*this.height,i=function(){var e,a,n;for(n=[],r=e=0,a=this.channels;0<=a?e<a:e>a;r=0<=a?++e:--e)n.push(this.data[r]);return n}.call(this),t=function(){var e,a,n;for(n=[],r=e=0,a=this.channels;0<=a?e<a:e>a;r=0<=a?++e:--e)n.push(this.data[r]);return n}.call(this),a=0,r=n=0,s=l;0<=s?n<s:n>s;r=0<=s?++n:--n)for(e=o=0,m=this.channels;0<=m?o<m:o>m;e=0<=m?++o:--o)this.data[a]>t[e]&&(t[e]=this.data[a]),this.data[a]<i[e]&&(i[e]=this.data[a]),a++;return[i,t]}},histogram=function(e,[r,a],n){var o,t,i,l,s,m;for(t=function(){var e,r,a;for(a=[],l=e=0,r=n;0<=r?e<r:e>r;l=0<=r?++e:--e)a.push(0);return a}(),i=(a-r)/n,s=0,m=e.length;s<m;s++)o=e[s],0<=(l=Math.floor((o-r)/i))&&l<n&&t[l]++;return t},segmented_colormap=function(e){return function(r){var a,n,o,t,i,l,s,m,c,d,u;if([d,u]=[0,0],[s,m]=[e[0][0],1],r<s)return d;for(a=n=0,o=e.length;n<o;a=++n){if([c,d,u]=e[a],s=c,a===e.length-1){m=1;break}if(m=e[a+1][0],c<=r&&r<m)break}for(l=[],a=t=0,i=d.length;0<=i?t<i:t>i;a=0<=i?++t:--t)l[a]=(r-s)/(m-s)*(u[a]-d[a])+d[a];return l}},get_channels=function(e){var r,a,n,o,t,i,l,s;for(i=e.width*e.height,l=new Float32Array(i),a=new Float32Array(i),r=new Float32Array(i),n=o=0,s=i;0<=s?o<s:o>s;n=0<=s?++o:--o)l[n]=e.data[4*n+0],a[n]=e.data[4*n+1],r[n]=e.data[4*n+2];return t=function(r){return new JsImage(r,e.width,e.height,1)},[t(l),t(a),t(r)]},ndvi=function(e,r){var a,n,o,t,i;for(t=e.width*e.height,a=new Float64Array(t),n=o=0,i=t;0<=i?o<i:o>i;n=0<=i?++o:--o)a[n]=(e.data[n]-r.data[n])/(e.data[n]+r.data[n]);return new JsImage(a,e.width,e.height,1)},greyscale_colormap=segmented_colormap([[0,[0,0,0],[255,255,255]],[1,[255,255,255],[255,255,255]]]),colormap1=segmented_colormap([[0,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.75,[255,255,0],[255,50,50]]]),colormap2=segmented_colormap([[0,[0,0,255],[0,0,255]],[.1,[0,0,255],[38,195,195]],[.5,[0,150,0],[255,255,0]],[.7,[255,255,0],[255,50,50]],[.9,[255,50,50],[255,50,50]]]),colormap=colormap1,update_colorbar=((e,r)=>{var a,n,o,t,i,l,s,m,c,d,u,p,g;for($("#colorbar-container")[0].style.display="inline-block",o=(n=(t=$("#colorbar")[0]).getContext("2d")).getImageData(0,0,t.width,t.height),l=c=0,p=t.width;0<=p?c<p:c>p;l=0<=p?++c:--c)for(s=d=0,g=t.height;0<=g?d<g:d>g;s=0<=g?++d:--d)[u,i,a]=colormap(l/t.width),m=4*(l+s*t.width),o.data[m+0]=u,o.data[m+1]=i,o.data[m+2]=a,o.data[m+3]=255;return n.putImageData(o,0,0),$("#colorbar-min")[0].textContent=e.toFixed(2),$("#colorbar-max")[0].textContent=r.toFixed(2)}),update=function(e){var r,a,n,o,t,i,l,s;return $("#colorbar-container")[0].style.display="none","ndvi"===mode?([l,a,r]=get_channels(e),t=ndvi(l,r),o=-1,n=1,i=function(e){return(e-o)/(n-o)},s=colorify(t,function(e){return colormap(i(e))}),update_colorbar(o,n)):"raw"===mode?s=new JsImage(e.data,e.width,e.height,4):"nir"===mode?([l,a,r]=get_channels(e),s=colorify(l,function(e){return[e,e,e]})):s=infragrammar(e),render(s)},save_expressions=function(r,g,b){return r=r.replace(/X/g,$("#slider").val()/100),g=g.replace(/X/g,$("#slider").val()/100),b=b.replace(/X/g,$("#slider").val()/100),""===r&&(r="R"),""===g&&(g="G"),""===b&&(b="B"),eval("r_exp = function(R,G,B){var r=R,g=G,b=B;return "+r+";}"),eval("g_exp = function(R,G,B){var r=R,g=G,b=B;return "+g+";}"),eval("b_exp = function(R,G,B){var r=R,g=G,b=B;return "+b+";}")},save_expressions_hsv=function(h,s,v){return h=h.replace(/X/g,$("#slider").val()/100),s=s.replace(/X/g,$("#slider").val()/100),v=v.replace(/X/g,$("#slider").val()/100),""===h&&(h="H"),""===s&&(s="S"),""===v&&(v="V"),eval("r_exp = function(R,G,B){var h=H,s=S,v=V,hsv = rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return hsv2rgb("+h+","+s+","+v+")[0];}"),eval("g_exp = function(R,G,B){var h=H,s=S,v=V,hsv = rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return hsv2rgb("+h+","+s+","+v+")[1];}"),eval("b_exp = function(R,G,B){var h=H,s=S,v=V,hsv = rgb2hsv(R, G, B), H = hsv[0], S = hsv[1], V = hsv[2]; return hsv2rgb("+h+","+s+","+v+")[2];}")},hsv2rgb=function(e,r,a){var n,o,t,i,l,s;if([],0===r)l=[a,a,a];else switch(o=Math.floor(6*e),n=6*e-o,t=a*(1-r),i=a*(1-n*r),s=a*(1-(1-n)*r),[a*(1-r),a*(1-r*(e-o)),a*(1-r*(1-(e-o)))],o){case 0:l=[a,s,t];break;case 1:l=[i,a,t];break;case 2:l=[t,a,s];break;case 3:l=[t,i,a];break;case 4:l=[s,t,a];break;default:l=[a,t,i]}return l},rgb2hsv=function(e,r,a){var n,o,t,i,l,s;if(t=Math.max(e,r,a),i=Math.min(e,r,a),o=l=s=t,n=t-i,l=0===t?0:n/t,t===i)o=0;else{switch(t){case e:o=(r-a)/n+(r<a?6:0);break;case r:o=(a-e)/n+2;break;case a:o=(e-r)/n+4}o/=6}return[o,l,s]},jsHandleOnClickRaw=function(){return set_mode("raw")},jsHandleOnClickNdvi=function(){return set_mode("ndvi")},jsHandleOnSubmitInfraHsv=function(){return save_expressions_hsv($("#h_exp").val(),$("#s_exp").val(),$("#v_exp").val()),set_mode("infragrammar_hsv")},jsHandleOnSubmitInfra=function(){return save_expressions($("#r_exp").val(),$("#g_exp").val(),$("#b_exp").val()),set_mode("infragrammar")},jsHandleOnSubmitInfraMono=function(){return save_expressions($("#m_exp").val(),$("#m_exp").val(),$("#m_exp").val()),set_mode("infragrammar_mono")},jsHandleOnClickGrey=function(){return colormap=greyscale_colormap,update(image)},jsHandleOnSlide=function(e){return"infragrammar"===mode?save_expressions($("#r_exp").val(),$("#g_exp").val(),$("#b_exp").val()):"infragrammar_hsv"===mode?save_expressions_hsv($("#h_exp").val(),$("#s_exp").val(),$("#v_exp").val()):save_expressions($("#m_exp").val(),$("#m_exp").val(),$("#m_exp").val()),update(image)},{colorify:colorify,getCurrentImage:getCurrentImage,runInfragrammar:runInfragrammar,save_expressions:save_expressions,save_expressions_hsv:save_expressions_hsv,updateImage:updateImage}}},{}],7:[function(e,r,a){(function(){var e,r,a,n,o,t,i,l,s,m,c,d,u;(d=[-1,-1,-1,1,1,-1,1,1]).itemSize=2,u=0,m=null,c=null,e=function(e,r){var a,n;return n=e.gl,a=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),a.itemSize=r.itemSize,a},a=function(e,r){var a,n;return a=e.gl,n=a.createTexture(),a.activeTexture(r),a.bindTexture(a.TEXTURE_2D,n),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e.canvas.width,e.canvas.height,0,a.RGBA,a.UNSIGNED_BYTE,null),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),n},r=function(r,n,o,i,l){var s;return s=new Object,s.mode=r,s.expression=["","",""],s.selColormap=n,s.colormap=o,s.slider=i,s.updateShader=!0,s.canvas=document.getElementById(l),s.canvas.addEventListener("webglcontextlost",function(e){return e.preventDefault()},!1),s.canvas.addEventListener("webglcontextrestored",t,!1),s.gl=getWebGLContext(s.canvas),s.gl?(s.gl.getExtension("OES_texture_float"),s.vertexBuffer=e(s,d),s.framebuffer=s.gl.createFramebuffer(),s.imageTexture=a(s,s.gl.TEXTURE0),s):null},n=function(e,r){var a,t,i,l,s,m,c,u;if(r||requestAnimFrame(function(){return n(e,!1)}),e.updateShader&&(e.updateShader=!1,o(e)),(a=e.gl).viewport(0,0,e.canvas.width,e.canvas.height),a.useProgram(e.shaderProgram),a.bindBuffer(a.ARRAY_BUFFER,e.vertexBuffer),u=a.getAttribLocation(e.shaderProgram,"aVertexPosition"),a.enableVertexAttribArray(u),a.vertexAttribPointer(u,e.vertexBuffer.itemSize,a.FLOAT,!1,0,0),s=a.getUniformLocation(e.shaderProgram,"uSampler"),a.uniform1i(s,0),c=a.getUniformLocation(e.shaderProgram,"uSlider"),a.uniform1f(c,e.slider),l=a.getUniformLocation(e.shaderProgram,"uNdvi"),a.uniform1i(l,"ndvi"===e.mode||e.colormap?1:0),m=a.getUniformLocation(e.shaderProgram,"uSelectColormap"),a.uniform1i(m,e.selColormap),i=a.getUniformLocation(e.shaderProgram,"uHsv"),a.uniform1i(i,"hsv"===e.mode?1:0),t=a.getUniformLocation(e.shaderProgram,"uColormap"),a.uniform1i(t,e.colormap?1:0),a.drawArrays(a.TRIANGLE_STRIP,0,d.length/d.itemSize),r)return e.canvas.toDataURL("image/jpeg")},o=function(e){var r,a,n,o;return[o,n,r]=e.expression,o=o.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),n=n.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),r=r.toLowerCase().replace(/h/g,"r").replace(/s/g,"g").replace(/v/g,"b"),o=o.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),n=n.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),r=r.replace(/[^xrgb\/\-\+\*\(\)\.0-9]*/g,""),o=o.replace(/([0-9])([^\.])?/g,"$1.0$2"),n=n.replace(/([0-9])([^\.])?/g,"$1.0$2"),r=r.replace(/([0-9])([^\.])?/g,"$1.0$2"),"ndvi"===e.mode&&(""!==o&&(o="(("+o+") + 1.0) / 2.0"),""!==n&&(n="(("+n+") + 1.0) / 2.0"),""!==r&&(r="(("+r+") + 1.0) / 2.0")),""===o&&(o="r"),""===n&&(n="g"),""===r&&(r="b"),a=$("#shader-fs-template").html(),a=a.replace(/@1@/g,o),a=a.replace(/@2@/g,n),a=a.replace(/@3@/g,r),$("#shader-fs").html(a),e.shaderProgram=createProgramFromScripts(e.gl,["shader-vs","shader-fs"])},i=function(e,r){return e.mode=r,e.updateShader=!0,"ndvi"===e.mode?($("#colorbar-container")[0].style.display="inline-block",$("#colormaps-group")[0].style.display="inline-block"):($("#colorbar-container")[0].style.display="none",$("#colormaps-group")[0].style.display="none")},l=function(){if(!(u-=1))return n(m),n(c)},t=function(){var e;if(e=m.imageData,m=r(m.mode,m.selColormap,m.colormap,m.slider,"image"),c=r(c.mode,c.selColormap,c.colormap,c.slider,"colorbar"),m&&c)return s(e)},s=function(e){var r;return r=m.gl,m.imageData=e,r.activeTexture(r.TEXTURE0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}}).call(this)},{}]},{},[2]);